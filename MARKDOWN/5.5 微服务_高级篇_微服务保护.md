# 5.5 微服务_高级篇_微服务保护

## 1.初识 Sentinel

### 1.1.雪崩问题及解决方案

- 1.1.1.雪崩问题

	- 微服务中，服务间调用关系错综复杂，一个微服务往往依赖于多个其它微服务。

		- 如图，如果服务提供者I发生了故障，当前的应用的部分业务因为依赖于服务I，因此也会被阻塞。

此时，其它不依赖于服务I的业务似乎不受影响。

			- 但是，依赖服务I的业务请求被阻塞，用户不会得到响应，则 tomcat 的这个线程不会释放。

于是越来越多的用户请求到来，越来越多的线程会阻塞。

				- 服务器支持的线程和并发数有限，请求一直阻塞，会导致服务器资源耗尽，从而导致所有其它服务都不可用。

那么当前服务也就不可用了。

那么，依赖于当前服务的其它服务随着时间的推移，最终也都会变的不可用，形成级联失败，雪崩就发生了。

					- 解决雪崩问题的常见方式

						- 超时处理
						- 仓壁模式（线程隔离）
						- 断路器模式（降级熔断）
						- 流量控制（限流）

- 1.1.2.超时处理

	- 超时处理：设定超时时间，请求超过一定时间没有响应就返回错误信息，不会无休止等待。

- 1.1.3.仓壁模式

	- 仓壁模式来源于船舱的设计。

船舱都会被隔板分离为多个独立空间，当船体破损时，只会导致部分空间进入，将故障控制在一定范围内，避免整个船体都被淹没。

于此类似，我们可以限定每个业务能使用的线程数，避免耗尽整个 tomcat 的资源，因此也叫线程隔离。

		- 

- 1.1.4.断路器

	- 断路器模式：由断路器统计业务执行的异常比例，如果超出阈值则会熔断该业务，拦截访问该业务的一切请求。

断路器会统计访问某个服务的请求数量，异常比例：当发现访问服务 D 的请求异常比例过高时，认为服务 D 有导致雪崩的风险，会拦截访问服务 D 的一切请求，形成熔断：

- 1.1.5.限流

	- 流量控制：限制业务访问的 QPS，避免服务因流量的突增而故障。

- 1.1.6.总结

	- 什么是雪崩问题？

		- 微服务之间相互调用，因为调用链中的一个服务故障，引起整个链路都无法访问的情况。

	- 如何避免因瞬间高并发流量而导致服务故障？

		- 流量控制

	- 如何避免因服务故障引起的雪崩问题？

		- 超时处理、线程隔离、降级熔断

	- 限流是对服务的保护，避免因瞬间高并发流量而导致服务故障，进而避免雪崩。是一种预防措施。
	- 超时处理、线程隔离、降级熔断是在部分服务故障时，将故障控制在一定范围，避免雪崩。是一种补救措施。

### 1.2.服务保护技术对比

- 在 SpringCloud 当中支持多种服务保护技术：

	- Netfix Hystrix
	- Sentinel
	- Resilience4J

- 早期比较流行的是 Hystrix 框架，但目前国内实用最广泛的还是阿里巴巴的 Sentinel 框架，这里我们做下对比：

	- 

### 1.3.Sentinel 介绍和安装

- 1.3.1.初识 Sentinel

	- Sentinel 是阿里巴巴开源的一款微服务流量控制组件。官网地址：https://sentinelguard.io/zh-cn/index.html
	- Sentinel 具有以下特征

		- 丰富的应用场景：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景 。

			- 例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。

		- 完备的实时监控：Sentinel 同时提供实时的监控功能。

			- 您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。

		- 广泛的开源生态：Sentinel 提供开箱即用的与其它开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。

			- 您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。

		- 完善的 SPI 扩展点：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。

			- 例如定制规则管理、适配动态数据源等。

- 1.3.2.安装 Sentinel

	- 1. 下载

		- sentinel 官方提供了 UI 控制台，方便我们对系统做限流设置。诸位可以在 GitHub上的 https://github.com/alibaba/Sentinel/releases 下载。课前资料也提供了下载好的 jar 包

	- 2. 运行

		- 

	- 3. 访问

		- 访问 http://localhost:8080 页面，就可以看到 sentinel 的控制台了。
		- 默认的账号和密码默认都是：sentinel

### 1.4.微服务整合 Sentinel

- 我们在 order-service 中整合 sentinel，并连接 sentinel 的控制台。

	- 

- 步骤：引入 sentinel 依赖；配置控制台；访问 order-service 的任意端点。

	- 1. 引入 sentinel 依赖

		- 

	- 2. 配置控制台
修改 application.yaml 文件，添加下面内容：

		- 

	- 3. 访问 order-service 的任意端点
打开浏览器，访问 http://localhost:8088/order/101，这样才能触发 sentinel 的监控。

然后再访问 sentinel 的控制台，查看效果：

		- 

## 2.流量控制

### 解决雪崩问题的常见方式有四种：超时处理、仓壁模式（线程隔离）、断路器模式（降级熔断）、流量控制（限流）。

- 其中限流是避免服务因突发的流量而发生故障，是对微服务雪崩问题的预防。

	- 我们先学习这种模式。

### 2.1.簇点链路

- 当请求进入微服务时，首先会访问 DispatcherServlet，然后进入 Controller、Service、Mapper，这样的一个调用链就叫做簇点链路。

簇点链路中被监控的每一个接口就是一个资源。

默认情况下 sentinel 会监控 SpringMVC 的每一个端点（Endpoint，也就是 controller 中的方法）。

因此 SpringMVC 的每一个端点（Endpoint）就是调用链路中的一个资源。

	- 

- 流控、熔断等都是针对簇点链路中的资源来设置的，因此我们可以点击对应资源后面的按钮来设置规则：

	- 流控：流量控制
	- 降级：降级熔断
	- 热点：热点参数限流，是限流的一种
	- 授权：请求的权限控制

### 2.2.JMeter 快速入门

- 2.2.1.下载 JMeter

	- Jmeter 依赖于 JDK，所以必须确保当前计算机上已经安装了 JDK，并且配置了环境变量。
	- 可以前往 Apache Jmeter 官网下载，地址：http://jmeter.apache.org/download_jmeter.cgi

- 2.2.2.启动 JMeter

	- 因为下载的是 zip 包，解压缩即可使用。
	- 目录其中的 bin 目录就是执行的脚本，其中包含启动脚本

- 2.2.3.运行 JMeter

	- 双击即可运行，但是有两点注意：

		- 启动速度比较慢，要耐心等待
		- 启动后黑窗口不能关闭，否则 Jmeter 也跟着关闭了

- 2.2.4.设置中文语言

	- 默认 Jmeter 的语言是英文，需要设置：
打开 jmeter 文件夹，在 bin 目录中找到 jmeter.properties，添加下面配置：
language=zh_CN

- 2.2.5.JMeter 基本用法

	- 在测试计划上点鼠标右键，选择 添加 > 线程（用户）> 线程组
	- 在新增的线程组中，填写线程信息
	- 给线程组点鼠标右键，添加 http 取样器
	- 编写取样器内容
	- 添加监听报告
	- 添加监听结果树
	- 汇总报告结果
	- 结果树

### 2.3.快速入门

- 2.3.1.案例

	- 点击资源 /order/{orderId} 后面的流控按钮，就可以弹出表单。

		- 

	- 表单中可以填写限流规则，如下

		- 其含义是限制 /order/{orderId} 这个资源的单机 QPS 为 1，即每秒只允许 1 次请求，超出的请求会被拦截并报错。

- 2.3.2.练习

	- 需求：给 /order/{orderId} 这个资源设置流控规则，QPS 不能超过 5，然后测试。
	- 1. 首先在 sentinel 控制台添加限流规则
	- 2. 利用 jmeter 测试

		- 课前资料提供了编写好的 Jmeter 测试样例
		- 打开 jmeter，导入课前资料提供的测试样例
		- 选择 测试样例：sentinel测试.jmx
		- 20 个用户，2 秒内运行完，QPS 是 10，超过了 5。
		- 选中 流控入门，QPS<5右键运行
		- 可以看到，成功的请求每次只有 5 个

### 2.4.流控模式

- 在添加限流规则时，点击高级选项，可以选择三种流控模式：

	- 直接：统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式
	- 关联：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流
	- 链路：统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流

- 2.4.1.关联模式

	- 关联模式：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流
	- 配置规则：
	- 语法说明：当 /write 资源访问量触发阈值时，就会对 /read 资源限流，避免影响 /write 资源。
	- 使用场景：

		- 比如用户支付时需要修改订单状态，同时用户要查询订单。
		- 查询和修改操作会争抢数据库锁，产生竞争。
		- 业务需求是优先支付和更新订单的业务，因此当修改订单业务触发阈值时，需要对查询订单业务限流。

- 2.4.2.关联模式案例

	- 需求说明：

		- 在 OrderController 新建两个端点：/order/query 和 /order/update，无需实现业务
		- 配置流控规则，当 /order/update 资源被访问的 QPS 超过 5 时，对 /order/query 请求限流

	- 1. 定义 /order/query 端点，模拟订单查询

		- 

	- 2. 定义 /order/update 端点，模拟订单更新

		- 

	- 3. 重启服务，查看 sentinel 控制台的簇点链路：

		- 

	- 4. 配置流控规则

		- 对哪个端点限流，就点击哪个端点后面的按钮。我们是对订单查询 /order/query 限流，因此点击它后面的按钮：
		- 在表单中填写流控规则：

	- 5. 在 JMeter 中测试

		- 选择 流控模式-关联

			- 可以看到 1000 个用户，100 秒，因此 QPS 为 10，超过了我们设定的阈值：5

查看 http 请求：

				- 请求的目标是 /order/update，这样这个断点就会触发阈值。

但限流的目标是 /order/query，我们在浏览器访问，可以发现：


- 2.4.3.关联模式总结

	- 满足下面的条件就可以使用关联模式：

		- 两个有竞争关系的资源
		- 一个优先级较高，一个优先级较低

- 2.4.4.链路模式

	- 链路模式：只针对从指定链路访问到本资源的请求做统计，判断是否超过阈值。
	- 配置示例

		- 

- 2.4.5.链路模式案例

	- 需求：

		- 有查询订单和创建订单业务，两者都需要查询商品。针对从查询订单进入到查询商品的请求统计，并设置限流。

	- 步骤：

		- 1. 在 OrderService 中添加一个 queryGoods 方法，不用实现业务
		- 2. 在 OrderController 中，改造 /order/query 端点，调用 OrderService 中的 queryGoods 方法
		- 3. 在 OrderController 中添加一个 /order/save 的端点，调用 OrderService 的 queryGoods 方法
		- 4. 重启服务，访问 /order/query 和 /order/save，查看 sentinel 的簇点链路
		- 5. 给 queryGoods 设置限流规则，从 /order/query 进入 queryGoods 的方法限制 QPS 必须小于 2
		- 6. Jmeter 测试

- 2.4.6.流控模式总结

	- 直接：对当前资源限流
	- 关联：高优先级资源触发阈值，对低优先级资源限流。
	- 链路：阈值统计时，只统计从指定资源进入当前资源的请求，是对请求来源的限流

### 2.5.流控效果

- 
- 2.5.1.warm up

	- 阈值一般是一个微服务能承担的最大 QPS。

但是一个服务刚刚启动时，一切资源尚未初始化（冷启动）；

如果直接将 QPS 跑到最大值，可能导致服务瞬间宕机。
	- warm up 也叫 预热模式，是应对服务冷启动的一种方案。

请求阈值初始值是 maxThreshold / coldFactor，持续指定时长后，逐渐提高到 maxThreshold 值。

而 coldFactor 的默认值是 3。

例如，我设置 QPS 的 maxThreshold 为 10，预热时间为 5 秒，那么初始阈值就是 10 / 3 ，也就是 3，然后在 5 秒后逐渐增长到 10。

- 2.5.2.排队等待

	- 当请求超过 QPS 阈值时，快速失败和 warm up 会拒绝新的请求并抛出异常。

而排队等待则是让所有请求进入一个队列中，然后按照阈值允许的时间间隔依次执行。

后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会被拒绝。
	- 工作原理

		- 

- 2.5.3.流控效果总结

	- 快速失败：QPS 超过阈值时，拒绝新的请求
	- warm up： QPS 超过阈值时，拒绝新的请求；QPS阈值是逐渐提升的，可以避免冷启动时高并发导致服务宕机。
	- 排队等待：请求会进入队列，按照阈值允许的时间间隔依次执行请求；如果请求预期等待时长大于超时时间，直接拒绝

### 2.6.热点参数限流

- 之前的限流是统计访问某个资源的所有请求，判断是否超过 QPS 阈值。

	- 而热点参数限流是分别统计参数值相同的请求，判断是否超过 QPS 阈值。

- 2.6.1.全局参数限流

	- 例如，一个根据 id 查询商品的接口

访问 /goods/{id} 的请求中，id 参数值会有变化，热点参数限流会根据参数值分别统计 QPS，统计结果：

当 id=1 的请求触发阈值被限流时，id 值不为 1 的请求不受影响。

		- 

	- 配置示例

		- 代表的含义是：对 hot 这个资源的 0 号参数（第一个参数）做统计，每 1 秒相同参数值的请求数不能超过 5

- 2.6.2.热点参数限流

	- 刚才的配置中，对查询商品这个接口的所有商品一视同仁，QPS 都限定为 5。

而在实际开发中，可能部分商品是热点商品，例如秒杀商品，我们希望这部分商品的 QPS 限制与其它商品不一样，高一些。

那就需要配置热点参数限流的高级选项了：
	- 结合上一个配置，这里的含义是对 0 号的 long 类型参数限流，每1秒相同参数的 QPS 不能超过 5，有两个例外：

		- 如果参数值是 100，则每 1 秒允许的 QPS 为 10
		- 如果参数值是 101，则每 1 秒允许的 QPS 为 15

- 2.6.3.案例

	- 案例需求：给 /order/{orderId} 这个资源添加热点参数限流，规则如下：

		- 默认的热点参数规则是每 1 秒请求量不超过 2
		- 给 102 这个参数设置例外：每 1 秒请求量不超过 4
		- 给 103 这个参数设置例外：每 1 秒请求量不超过 10
		- 注意事项：热点参数限流对默认的 SpringMVC 资源无效，需要利用 @SentinelResource 注解标记资源

	- 1. 标记资源

		- 给 order-service 中的 OrderController 中的 /order/{orderId} 资源添加注解
		- src/main/java/cn/itcast/order/web/OrderController.java

	- 2. 热点参数限流规则

		- 访问该接口，可以看到我们标记的 hot 资源出现了：
		- 这里不要点击 hot 后面的按钮，页面有 BUG
		- 点击左侧菜单中热点规则菜单：
		- 点击新增，填写表单：

	- 3. JMeter 测试

		- 选择 热点参数限流 QPS1
		- 这里发起请求的 QPS 为 5
		- 包含 3 个 http 请求：普通参数，QPS 阈值为 2
		- 运行结果
		- 例外项，QPS 阈值为 4
		- 例外项，QPS 阈值为 10
		- 运行结果

## 3.隔离和降级

### Intro

- 限流是一种预防措施，虽然限流可以尽量避免因高并发而引起的服务故障，但服务还会因为其它原因而故障。
- 而要将这些故障控制在一定范围，避免雪崩，就要靠线程隔离（舱壁模式）和熔断降级手段了。

	- 线程隔离
	- 熔断降级
	- 可以看到，不管是线程隔离还是熔断降级，都是对 客户端（调用方） 的保护。

需要在 调用方 发起远程调用时做线程隔离、或者服务熔断。

而我们的微服务远程调用都是基于 Feign 来完成的，因此我们需要将 Feign 与 Sentinel 整合，在 Feign 里面实现线程隔离和服务熔断。

### 3.1.FeignClient 整合 Sentinel

- 3.1.1.修改配置，开启 sentinel 功能

	- 修改 OrderService 的 application.yml 文件，开启 Feign 的 Sentinel 功能
	- src/main/resources/application.yml

- 3.1.2.编写失败降级逻辑

	- 业务失败后，不能直接报错，而应该返回用户一个友好提示或者默认结果，这个就是失败降级逻辑。
	- 给 FeignClient 编写失败后的降级逻辑

		- 方式一：FallbackClass，无法对远程调用的异常做处理
		- 方式二：FallbackFactory，可以对远程调用的异常做处理

			- 步骤一：在 feing-api 项目中定义类，实现 FallbackFactory

				- src/main/java/cn/itcast/feign/clients/fallback/UserClientFallbackFactory.java

			- 步骤二：在 feing-api 项目中的 DefaultFeignConfiguration 类中将 UserClientFallbackFactory 注册为一个 Bean

				- src/main/java/cn/itcast/feign/config/DefaultFeignConfiguration.java

			- 步骤三：在 feing-api 项目中的 UserClient 接口中使用 UserClientFallbackFactory

				- src/main/java/cn/itcast/feign/clients/UserClient.java

			- 重启后，访问一次订单查询业务，然后查看 sentinel 控制台，可以看到新的簇点链路：

- 3.1.3.总结

	- Sentinel 支持的雪崩解决方案：

		- 线程隔离（仓壁模式）
		- 降级熔断

	- Feign 整合 Sentinel 的步骤：

		- 在 application.yml 中配置：feign.sentienl.enable=true
		- 给 FeignClient 编写 FallbackFactory 并注册为 Bean
		- 将 FallbackFactory 配置到 FeignClient

### 3.2.线程隔离（舱壁模式）

- 3.2.1.线程隔离的实现方式

	- 线程池隔离

		- 优点：支持主动超时；支持异步调用
		- 缺点：线程的额外开销比较大
		- 场景：低扇出

	- 信号量隔离（Sentinel 默认采用）

		- 优点：轻量级，无额外开销
		- 缺点：不支持主动超时；不支持异步调用
		- 场景：高频调用、高扇出

	- 

- 3.2.2.sentinel的线程隔离

	- 用法说明：
在添加限流规则时，可以选择两种阈值类型：

		- QPS：就是每秒的请求数，在快速入门中已经演示过
		- 线程数：是该资源能使用用的 tomcat 线程数的最大值。也就是通过限制线程数量，实现线程隔离（舱壁模式）。

- 3.2.3.案例

	- 案例需求：给 order-service 服务中的 UserClient 的查询用户接口设置流控规则，线程数不能超过 2。然后利用 jemeter 测试。
	- 1. 配置隔离规则

		- 选择 feign 接口后面的流控按钮

			- 填写表单

	- 2. JMeter 测试

		- 选择 阈值类型-线程数<2

			- 一次发生 10 个请求，有较大概率并发线程数超过 2，而超出的请求会走之前定义的失败降级逻辑。

				- 查看运行结果：

- 3.2.4.总结

	- 线程隔离的两种手段是？

		- 信号量隔离
		- 线程池隔离

	- 信号量隔离的特点是？

		- 基于计数器模式，简单，开销小

	- 线程池隔离的特点是？

		- 基于线程池模式，有额外开销，但隔离控制更强

### 3.3.熔断降级

- Intro

	- 熔断降级是解决雪崩问题的重要手段。其思路是由断路器统计服务调用的异常比例、慢请求比例，如果超出阈值则会熔断该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。

		- 断路器控制熔断和放行是通过状态机来完成的：

	- 状态机包括三个状态：

		- closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到 open 状态
		- open：打开状态，服务调用被熔断，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open 状态 5 秒后会进入 half-open 状态
		- half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作

			- 请求成功：则切换到 closed 状态
			- 请求失败：则切换到 open 状态

	- 断路器熔断策略有三种

		- 慢调用、异常比例、异常数

- 3.3.1.慢调用

	- 

- 3.3.2.案例1（慢调用）

	- 需求：

		- 给 UserClient 的查询用户接口设置降级规则。
		- 慢调用的 RT 阈值为 50ms，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5。

	- 1. 设置慢调用

		- 修改 user-service 中的 /user/{id} 这个接口的业务。
		- 通过休眠模拟一个延迟时间：
		- src/main/java/cn/itcast/user/web/UserController.java
		- 此时，orderId=101 的订单，关联的是 id 为 1 的用户，调用时长为 89ms（超过 60 ms）：
		- orderId=102 的订单，关联的是 id 为 2 的用户，调用时长为非常短；

	- 2. 设置熔断规则

		- 下面，给 feign 接口设置降级规则
		- 这里设置超过 50ms 的请求都会被认为是慢请求

	- 3. 测试

		- 在浏览器访问：http://localhost:8088/order/101，快速刷新 5 次，可以发现：
		- 触发了熔断，请求时长缩短至 5ms，快速失败了，并且走降级逻辑，返回的 null
		- 在浏览器访问：http://localhost:8088/order/102，竟然也被熔断了：

- 3.3.3.异常比例、异常数

	- 统计指定时间内的调用，如果调用次数超过指定请求数，并且出现异常比例达到设定的比例阈值（或超过指定异常数），则触发熔断。

		- 

- 3.3.4.案例2（异常比例/异常数）

	- 需求：给 UserClient 的查询用户接口设置降级规则，统计时间为 1 秒，最小请求数量为 5，失败阈值比例为 0.4，熔断时长为 5 s
	- 1. 设置异常请求

		- 修改 user-service 中的 /user/{id} 这个接口的业务。

手动抛出异常，以触发异常比例的熔断：

src/main/java/cn/itcast/user/web/UserController.java

	- 2. 设置熔断规则

		- 给 feign 接口设置降级规则

	- 3. 测试

		- 在浏览器快速访问：http://localhost:8088/order/102，快速刷新 5 次，触发熔断：

- 3.3.5.总结

	- 慢调用比例：超过指定时长的调用为慢调用，统计单位时长内慢调用的比例，超过阈值则熔断
	- 异常比例：统计单位时长内异常调用的比例，超过阈值则熔断
	- 异常数：统计单位时长内异常调用的次数，超过阈值则熔断

## 4.授权规则

### 4.1.授权规则

- 4.1.1.基本规则

	- 授权规则可以对调用方的来源做控制，有白名单和黑名单两种方式。

		- 白名单：来源（origin）在白名单内的调用者允许访问
		- 黑名单：来源（origin）在黑名单内的调用者不允许访问

	- 授权规则：

		- 资源名：就是受保护的资源，例如 /order/{orderId}
		- 流控应用：是来源者的名单，
		- 

- 4.1.2.如何获取 origin

	- 

- 4.1.3.给网关添加请求头

	- 

- 4.1.4.配置授权规则

### 4.2.自定义异常结果

- Intro

	- 默认情况下，发生限流、降级、授权拦截时，都会抛出异常到调用方。
异常结果都是 flow limmiting（限流）。
这样不够友好，无法得知是限流还是降级还是授权拦截。

- 4.2.1.异常类型

	- 而如果要自定义异常时的返回结果，需要实现 BlockExceptionHandler 接口：这个方法有三个参数：

		- HttpServletRequest request：request 对象
		- HttpServletResponse response：response 对象
		- BlockException e：被 sentinel 拦截时抛出的异常
		- 

- 4.2.2.自定义异常处理

	- 下面，我们就在 order-service 定义一个自定义异常处理类：

		- src/main/java/cn/itcast/order/sentinel/SentinelExceptionHandler.java

- 4.2.3.总结

	- 获取请求来源的接口是什么？

		- RequestOriginParser

	- 处理 BlockException 的接口是什么？

		- BlockExceptionHandler

## 5.规则持久化

### Intro

- sentinel 的所有规则都是内存存储，重启后所有规则都会丢失。在生产环境下，我们必须确保这些规则的持久化，避免丢失。

### 5.1.规则管理模式

- 三种模式

	- 原始模式：Sentinel 的默认模式，将规则保存在内存，重启服务会丢失。
	- pull 模式：保存在本地文件或数据库，定时去读取
	- push 模式：保存在 nacos，监听变更实时更新（推荐）

- 5.1.1.pull 模式

	- 

- 5.1.2.push 模式

	- 

### 5.2.实现 push 模式

- push 模式的实现最为复杂，依赖于 nacos，且需要修改 Sentinel 控制台的源码。
- 5.2.1.修改 order-service 服务

	- 1. 导入依赖

		- 在 order-service 中引入 sentinel 监听 nacos 的依赖：

	- 2. 配置 nacos 地址

		- 在 order-service 中的 application.yml 文件配置 nacos 地址及监听的配置信息：

- 5.2.2.修改 sentinel-dashboard 源码

	- 

*XMind: ZEN - Trial Version*