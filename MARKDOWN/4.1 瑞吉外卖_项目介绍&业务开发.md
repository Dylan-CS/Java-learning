# 4.1 瑞吉外卖_项目介绍&业务开发

## 1. 软件开发概述

### 1.软件开发流程

- 需求分析、设计、编码、测试、上线运维

### 2.角色分工

- 项目经理:对整个项目负责，任务分配、把控进度
- 产品经理:进行需求调研，输出需求调研文档、产品原型等
- UI设计师: 根据产品原型输出界面效果图
- 架构师:项目整体架构设计、技术选型等
- 开发工程师:代码实现
- 测试工程师:编写测试用例，输出测试报告
- 运维工程师:软件环境搭建、项目上线

### 3.软件环境

- 开发环境(development): 开发人员在开发阶段使用的环境，一般外部用户无法访问
- 测试环境(testing): 专门给测试人员使用的环境，用于测试项目，一般外部用户无法访问
- 生产环境(production):即线上环境，正式提供对外服务的环境

## 2.项目介绍

### 1.项目概述

- 本项目(瑞吉外卖)是专门为餐饮企业(餐厅、饭店)定制的一款软件产品，包括系统管理后台和移动端应用两部分其中系统管理后台主要提供给餐饮企业内部员工使用，可以对餐厅的菜品、套餐、订单等进行管理维护。移动端应用主要提供给消费者使用，可以在线浏览菜品、添加购物车、下单等

	- 本项目共分为3期进行开发:

第一期主要实现基本需求，其中移动端应用通过H5实现，用户可以通过手机浏览器访问。

第二期主要针对移动端应用进行改进，使用微信小程序实现，用户使用起来更加方便。

第三期主要针对系统进行优化升级，提高系统的访问性能。

### 2.技术选型

- 

### 3.项目架构

- 

### 4.角色

- 后台系统管理员:登录后台管理系统，拥有后台系统中的所有操作权限
- 后台系统普通员工:登录后台管理系统，对菜品、套餐、订单等进行管理
- C端用户:登录移动端应用，可以浏览菜品、添加购物车、设置地址、在线下单等

## 3.管理端

### 1.开发环境搭建

- 1.数据库环境搭建
- 2.Maven项目搭建

### 2.登录、退出功能

- 1.需求分析

	- 

- 2.代码开发

	- 1.创建实体类Employee，和employee表映射
	- 2.创建Controller，Service，Mapper
	- 3.导入返回结果类R
此类是一个通用结果类，服务端响应的所有结果最终都会包装成此种类型返回给前端页面
	- 4. 在Controller中创建登录方法

- 3.完善登录功能（拦截器）

	- 需求分析

		- 使用过滤器或者拦截器，在过滤器或者拦截器中判断用户是否已经完成登录，如果没有登录则跳转到登录页面

	- 代码实现

		- 1.创建自定义过滤器LoginCheckFilter
		- 2. 在启动类上加入注解@ServletComponentScan

	- 完善过滤器的处理逻辑

		- 1、获取本次请求的URI
		- 2、判断本次请求是否需要处理
		- 3、如果不需要处理，则直接放行
		- 4、判断登录状态，如果已登录，则直接放行
		- 5、如果未登录则返回未登录结果

### 3.员工管理功能(新增、分页、更新、查询)

- 新增

	- 需求分析

		- 数据模型：新增员工，其实就是将我们新增页面录入的员工数据插入到employee表。需要注意，employee表中对username字段加入了唯一约束，因为username是员工的登录账号，必须是唯一的

	- 执行流程

		- 1.页面发送ajax请求，将新增员工页面中输入的数据以json的形式提交到服务端
		- 2.服务端Controller接收页面提交的数据并调用Service将数据进行保存
		- 3.Service调用Mapper操作数据库，保存数据

- 分页查询

	- 技术选型

		- 配置MybatisPlus插件

	- 执行流程

		- 页面发送ajax请求，将分页查询参数(page.pageSize、name)提交到服务端
		- 服务端Controller接收页面提交的数据并调用Service查询数据
		- Service调用Mapper操作数据库，查询分页数据
		- Controller将查询到的分页数据响应给页面
		- 页面接收到分页数据并通过ElementUI的Table组件展示到页面上

- 启用、禁用员工账号

	- 需求分析

		- 只有管理员（admin用户）可以对其他普通用户进行启用、禁用操作，所以普通用户登录系统后启用、禁用按钮不显示。

	- 代码开发

		- 1.页面中是怎么做到只有管理员admin能够看到启用、禁用按钮的？

			- 

		- 3.执行流程

			- 1、页面发送ajax请求，将参数(id、 status)提交到服务端
			- 2、服务端Controller接收页面提交的数据并调用Service更新数据
			- 3、Service调用Mapper操作数据库

		- 2.页面中的ajax请求是如何发送的？

			- 

- 更新

	- 需求分析

		- 在员工管理列表页面点击编辑按钮，跳转到编辑页面，在编辑页面回显员工信息并进行修改，最后点击保存按钮完成编辑操作

	- 代码执行

		- 1.工作流程

			- 1、点击编辑按钮时，页面跳转到add.html，并在url中携带参数[员工id]
			- 2、在add.html页面获取url中的参数[员工id]
			- 3、发送ajax请求，请求服务端，同时提交员工id参数
			- 4、服务端接收请求，根据员工id查询员工信息，将员工信息以json形式响应给页面
			- 5、页面接收服务端响应的json数据，通过VUE的数据绑定进行员工信息回显
			- 6、点击保存按钮，发送ajax请求，将页面中的员工信息以json方式提交给服务端
			- 7、服务端接收员工信息，并进行处理，完成后给页面响应
			- 8、页面接收到服务端响应信息后进行相应处理

### 4.分类管理(新增、分页、更新、查询)

- 公共字段自动填充

	- 问题分析

		- 前面我们已经完成了后台系统的员工管理功能开发，在新增员工时需要设置创建时间、创建人、修改时间、修改人等字段，在编辑员工时需要设置修改时间和修改人等字段。这些字段属于公共字段，也就是很多表中都有这些字段
		- 能不能对于这些公共字段在某个地方统一处理，来简化开发呢?

答案就是使用Mybatis Plus提供的公共字段自动填充功能。

	- 代码实现

		- 1、在实体类的属性上加入@TableField注解，指定自动填充的策略
		- 2、按照框架要求编写元数据对象处理器，在此类中统一为公共字段赋值，此类需要实现MetaObjectHandler接口

			- 

	- 功能完善

		- 前面我们已经完成了公共字段自动填充功能的代码开发，但是还有一个问题没有解决，就是我们在自动填充createUser和updateUser时设置的用户id是固定值，现在我们需要改造成动态获取当前登录用户的id。

			- 有的同学可能想到，用户登录成功后我们将用户id存入了HttpSession中，现在我从HttpSession中获取不就行了?

注意，我们在MyMetaObjectHandler类中是不能获得HttpSession对象的，所以我们需要通过其他方式来获取登录用户id。

		- 前置知识

			- 可以使用ThreadLocal来解决此问题,它是JDK中提供的一个类。

在学习ThreadLocal之前，我们需要先确认一个事情，就是客户端发送的每次http请求，对应的在服务端都会分配一个新的线程来处理，在处理过程中涉及到下面类中的方法都属于相同的一个线程:
1、LoginCheckFilter的doFilter方法
2、EmployeeContraller的update方法
3、MyMetaObjectHandler的updateFill方法

		- 子主题 3

- 新增分类

	- 需求分析
	- 数据模型
	- 代码开发

		- 开发顺序

			- 实体类Category(直接从课程资料中导入即可)
			- Mapper接口CategoryMapper
			- 业务层接口CategoryService
			- 业务层实现类CategoryServicelmpl
			- 控制层CategoryController

		- 执行流程

			- 1、页面(backend/page/category/list.html)发送ajax请求，将新增分类窗口输入的数据以json形式提交到服务端
			- 2、服务端Controller接收页面提交的数据并调用Service将数据进行保存
			- 3、Service调用Mapper操作数据库，保存数据

- 分类信息分页查询

	- 需求分析
	- 代码开发

- 删除分类

	- 需求分析
	- 代码开发
	- 代码完善

		- 实现了根据id删除分类的功能，但是并没有检查删除的分类是否关联了菜品或者套餐，所以我们需要进行功能完善。
		- 1、实体类Dish和Setmeal （从课程资料中复制即可)
		- 2、Mapper接口DishMapper和SetmealMapper
		- 3、Service接口DishService和SetmealService
		- 4、Service实现类DishServicelmpl和SetmealServicelmpl

	- 关键代码

		- 在CategoryService添加remove方法
		- 在CategoryServicelmpl实现remove方法
		- 定义异常类CustomException
		- 在全局异常处理器GlobalExceptionHandler添加

- 修改分类

	- 需求分析
	- 代码实现

### 5.菜品管理(新增、分页、更新、查询)

- 文件上传下载

	- 文件上传介绍

		- 

	- 文件下载介绍

		- 文件下载，也称为download，是指将文件从服务器传输到本地计算机的过程。
		- 通过浏览器进行文件下载，通常有两种表现形式:

			- 以附件形式下载，弹出保存对话框，将文件保存到指定磁盘目录
			- 直接在浏览器中打开

		- 通过浏览器进行文件下载，本质上就是服务端将文件以流的形式写回浏览器的过程。

	- 文件上传代码实现
	- 文件下载代码实现

- 新增菜品

	- 需求分析
	- 数据模型
	- 代码开发-准备工作
	- 代码开发-梳理交互过程

		- 在开发代码之前，需要梳理一下新增菜品时前端页面和服务端的交互过程:

			- 1、页面(backend/page/food/add.html)发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中
			- 2、页面发送请求进行图片上传，请求服务端将图片保存到服务器
			- 3、页面发送请求进行图片下载，将上传的图片进行回显
			- 4、点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端

		- 开发新增菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。

- 菜品信息分页查询

	- 需求分析
	- 代码开发-梳理交互过程

		- 梳理一下菜品分页查询时前端页面和服务端的交互过程:

			- 2、页面发送请求，请求服务端进行图片下载，用于页面图片展示
			- 1、页面(backend/page/food/list.html)发送ajax请求，将分页查询参数(page、pageSize、name)提交到服务端，获取分页数据

		- 开发菜品信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。

- 修改菜品

	- 需求分析
	- 代码开发-梳理交互过程

		- 1、页面发送ajax请求，请求服务端获取分类数据，用于菜品分类下拉框中数据展示
		- 2、页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显

- 停售/起售菜品，删除菜品

	- 需求分析
	- 代码实现

		- 梳理一下新增套餐时前端页面和服务端的交互过程:

			- 1、页面(backend/ page/comboladd.html)发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中
			- 2、页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中
			- 3、页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中

### 6.套餐管理业务开发

- 新增套餐

	- 需求分析
	- 数据模型
	- 代码开发-准备工作
	- 代码开发-梳理交互过程

- 套餐分页查询

	- 需求分析
	- 代码开发-梳理交互过程

- 删除、起售、停售套餐

	- 需求分析
	- 代码实现

- 修改套餐

	- 需求分析
	- 代码开发-梳理交互过程

		- 1、页面发送ajax请求，请求服务端获取分类数据，用于套餐分类下拉框中数据展示
		- 2、页面发送ajax请求，请求服务端，根据id查询当前套餐信息，用于套餐信息回显
		- 3、页面发送请求，请求服务端进行图片下载，用于页图片回显
		- 4、点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端

## 4.移动端

### 1.手机验证码登录

- 短信发送

	- 短信服务介绍

		- 阿里云、华为云、腾讯云、京东、梦网、乐信

	- 阿里云短信服务-介绍

		- 验证码
		- 短信通知
		- 推广短信

	- 阿里云短信服务-注册账号
	- 阿里云短信服务-设置短信签名
	- 阿里云短信服务-设置短信模板
	- 阿里云短信服务-设置AccessKey
	- 代码开发

		- 1、导入maven坐标
		- 2、调用API

- 手机验证码登录

	- 需求分析
	- 数据模型
	- 代码开发

		- 流程

			- 1、在登录页面(front/page/login.html)输入手机号，点击【获取验证码】按钮，页面发送ajax请求，在服务端调用短信服务API给指定手机号发送验证码短信
			- 2、在登录页面输入验证码，点击【登录】按钮，发送ajax请求，在服务端处理登录请求
			- 前面我们已经完成了LogincheckFilter过滤器的开发，此过滤器用于检查用户的登录状态。我们在进行手机验证码登录时，发送的请求需要在此过滤器处理时直接放行。

	- 效果展示

### 2.用户地址簿相关

- 需求分析
- 数据模型
- 导入功能代码
- 功能测试

### 3.菜品展示

- 需求分析
- 代码开发

	- 代码开发-梳理交互过程

		- 1、页面(front/index.html)发送ajax请求，获取分类数据（菜品分类和套餐分类)
		- 2、页面发送ajax请求，获取第一个分类下的菜品或者套餐

	- 注意:首页加载完成后，还发送了一次ajax请求用于加载购物车数据，此处可以将这次请求的地址暂时修改一下，从静态json文件获取数据，等后续开发购物车功能时再修改回来，如下:
	- 开发菜品展示功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。

- 功能测试

### 4.购物车

- 需求分析
- 数据模型
- 代码开发

	- 代码开发-梳理交互过程

		- 1、点击 [加入购物车] 或者 [+] 按钮，页面发送ajax请求，请求服务端，将菜品或者套餐添加到购物车
		- 2、点击购物车图标，页面发送ajax请求，请求服务端查询购物车中的菜品和套餐
		- 3、点击清空购物车按钮，页面发送ajax请求，请求服务端来执行清空购物车操作
		- 开发购物车功能，其实就是在服务端编写代码去处理前端页面发送的这3次请求即可。

	- 代码开发-准备工作
	- 代码开发-添加购物车
	- 代码开发-查看购物车
	- 代码开发-清空购物车
	- 代码开发-减少菜品

### 5.下单

- 需求分析
- 数据模型
- 代码开发

	- 代码开发-梳理交互过程

		- 1、在购物车中点击 【去结算】 按钮，页面跳转到订单确认页面
		- 2、在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的默认地址
		- 3、在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的购物车数据
		- 4、在订单确认页面点击 【去支付】 按钮，发送ajax请求，请求服务端完成下单操作

	- 代码开发-准备工作

		- 实体类Orders、OrderDetail（直接从课程资料中导入即可)
		- Mapper接口OrderMapper、OrderDetailMapper
		- 业务层接口OrderService、OrderDetailService
		- 业务层实现类OrderServicelmpl、OrderDetailServicelmpl
		- 控制层OrderController、OrderDetailController

	- 代码开发
	- 功能测试

### 6.功能补充

- 用户登出

	- 在UserController添加loginout方法

- 订单管理

	- 导入OrderDto需手动添加private int sumNum;（前端会计算数量）
	- 在OrderController添加userPage方法

- 再来一单

	- 在OrderController中添加again方法处理post请求

- 管理端订单明细

	- 在OrderController添加page方法处理get请求

- 外卖订单派送

	- 在OrderController处理post请求修改status

*XMind: ZEN - Trial Version*